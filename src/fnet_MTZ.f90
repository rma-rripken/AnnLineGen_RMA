module fnet_MTZ

! a = 2.7902e-005
! b = 0.12514

intrinsic Reshape
real, dimension(8,126) :: input = &
  Reshape((/0.404919428691,-0.588687685640,-0.064280363917,-0.237069962140,0.283083554667,-0.083214839317,-0.100741576671,0.478495902691,0.008287842145,0.449925601506,0.058811785628,-0.172127570120 &
            ,-0.125300410576,-0.021096439798,0.029693483150,0.021178773753,-0.253676403826,-0.719606041697,-0.142066092052,0.249150095270,0.205981373538,0.101906140287,0.001210861679,-0.147085886069 &
            ,-0.095600682086,0.754657448848,-0.000345170782,0.195224542823,0.191949337161,0.003783577711,-0.070683093284,0.034412934940,-0.010715410508,0.537889680562,-0.882532844050,-0.329764466539 &
            ,0.575726863932,-0.181078570995,0.109554870892,-0.156463506774,0.044895156405,0.113361042373,-0.027914100390,0.010502214379,0.180692291061,0.026837708628,0.034544727885,-0.074492511901 &
            ,0.020036089820,0.670128415978,0.164657304625,-0.036117377293,0.001818297209,0.063197953024,-0.046005527647,0.201787149758,-0.232531657479,0.748704885931,0.148093950602,0.079273618390 &
            ,-0.267070589983,-0.052843233641,0.032221474061,-0.266825195736,-0.196844590817,-1.839980478672,0.464280186344,0.207951261260,-0.413584552498,0.160571262130,-0.032706356001,0.001741185207 &
            ,0.143956760663,0.739401195562,-0.646726114462,-0.362255353086,0.456316473572,-0.079584161120,0.058550137704,0.167461827219,-0.065404317022,-0.986595186975,0.048937916180,-0.038811845513 &
            ,-0.055464927112,0.084420799753,0.030605711743,-0.010182295577,-0.013865997323,0.341730446909,-0.020384239560,0.028494336606,0.087267709999,-0.005918764454,-0.022930923800,0.044203370747 &
            ,-0.172194092746,14.082188878001,0.029498845196,0.072930731517,-0.035732893089,-0.042808950114,0.242343666913,-0.122677513410,0.067011131135,-0.011933134669,0.091447597069,0.026509046605 &
            ,-0.077874371637,0.031158606400,0.002460408599,0.000250633777,-0.249162464918,-0.286830630551,0.009742692286,0.010285744249,-0.039079586756,0.019088377571,0.006519101936,-0.055630464828 &
            ,0.097011266404,-0.065950350084,0.014384121724,0.023583324130,0.022228990759,-0.031977307412,-0.004724758353,-0.041948187955,0.031810055343,0.228863809463,0.027701716797,-0.012479480857 &
            ,-0.011860058929,-0.003469260820,0.024138024102,-0.075624853028,-0.046211210238,0.134769179083,-0.197436161342,-0.078510460406,0.284940298974,0.082983185739,0.078631580454,-0.060644965267 &
            ,-1.560867577428,-1.705676126655,-1.544491809667,-0.139721376227,0.926792715875,-0.209646997510,0.344992511366,-1.132601059186,-1.126897345989,1.254861399918,-1.425874031068,0.614166757777 &
            ,0.641561964337,-0.402894586876,0.333776861339,-1.731080579446,-1.203397571188,2.389829544424,-0.051814902660,-0.735547699213,-1.605048673687,0.035323960659,0.620220944777,-1.217527342028 &
            ,-1.976456341168,-3.867093409631,-0.192499539779,0.454987952351,-1.421016289443,0.143434332815,-0.215618294240,0.349250393384,-0.760929709239,0.655208934817,1.521766900417,0.471772618193 &
            ,-1.514820570700,-0.171149513728,-0.348771154062,0.435142490834,-0.202105899348,1.842270952716,1.223651632477,0.299686313288,-0.321993064713,0.361014261873,-0.444764289823,1.171960615815 &
            ,-0.749104875036,-4.441659966574,0.018895161141,0.376664733331,-0.578688083734,0.028239290597,-0.280004927338,0.506801197452,-1.947461177225,-8.344285990703,-0.590377388921,0.622659457384 &
            ,-0.482559363366,-0.373293902167,-0.403849893950,0.495252001581,-1.428252562908,0.327841525018,-0.200361413845,0.346534272717,0.416529010864,-0.339711998377,-0.524931449170,1.226505651660 &
            ,1.119667253039,1.968127951419,-2.899870869220,0.451084563918,2.312091921138,-1.869971721616,-0.248628918758,0.090790224673,-0.500790616572,-1.239149678750,-1.008563612280,-0.089366484857 &
            ,0.754197653241,0.057269013771,0.057151125416,0.113224202056,0.289666606048,2.512876462856,-0.293136885170,-0.005212240147,0.454214887749,-0.006767223617,0.133106261152,-0.247208635436 &
            ,-0.097321884961,0.193502155161,-0.100297245887,0.109792631351,0.069564506528,0.077218646587,0.086263798614,-0.188938906112,0.068437311118,-0.752201070990,-0.566682475585,-0.222180527593 &
            ,0.515048082514,-0.071481650306,0.135086338280,-0.229024402249,0.654989035877,0.382718484673,0.053553954450,0.327671902767,-0.136841378066,-0.251166595049,-0.110583216593,0.060384229869 &
            ,-0.242106473670,-0.552988830272,-0.290429252709,-0.403296414603,-0.051699876428,-0.059570686935,0.148283011112,0.011984628435,0.241193401591,0.481756102817,-0.049971037907,-0.221477303658 &
            ,0.088134448061,0.087445196336,0.196567304319,-0.250659731025,-0.232867188776,0.868333518005,-0.020837331329,-0.466820633325,-0.275188449205,-0.095438861739,0.427785909095,-1.019477279207 &
            ,-0.530008645417,-2.694728804169,1.693916887647,1.105595743048,-1.947463289630,-0.153227351865,-0.583189403862,0.362391825848,-1.739297533449,-5.003962166360,0.898384385232,0.573821845859 &
            ,-2.904104055556,0.239571446310,-0.601582947146,1.042846164130,1.260837955650,3.530669047566,-0.033336279167,-2.347436344284,-1.578076978220,-0.455880380175,-0.223919474362,2.361567165023 &
            ,-1.595620804000,7.173061894363,-0.565276148147,-1.350364867855,-0.183092873007,0.269756736511,0.414155577100,1.413138863803,2.403347466566,12.630225095718,0.416645117017,-0.866782262983 &
            ,0.406274553644,-0.802403889549,0.803667362945,-1.344785672467,2.324639154495,16.221298303301,-0.537343086819,0.847848303128,2.052291762535,-0.506638235606,0.074849430211,-0.710512547396 &
            ,3.434197202321,11.427550867928,1.689194358189,1.421321489093,0.030003208384,-0.871793810817,-0.192273060911,-1.838830886080,0.799476085991,6.536005386317,1.482472937314,2.137375237713 &
            ,-0.745183341180,-0.589607432665,-0.173061543071,-2.245575520152,1.950977276592,-7.571922178241,3.366938458269,0.422024136973,-5.168055261869,0.897815483222,-0.165570476982,0.671634456387 &
            ,-2.540302378360,-16.177450159650,2.873701502485,1.359220060500,-5.187782163937,2.252896876501,-0.331164401137,2.261924337458,-0.230366969186,-0.472455209103,0.757871684206,-0.055966917024 &
            ,-0.498894079170,0.448395056296,-0.046829742323,0.121527667655,0.187590923959,-2.872336674911,-0.045998839335,0.223147345774,-0.574070389727,-0.211312274005,-0.060998603502,-0.108216289968 &
            ,-0.390101122431,-2.552573534296,0.261918863750,-0.089142119647,-0.630439999330,0.262045132625,-0.003241121375,0.257295892457,0.061344798266,-1.783520783775,-1.041162866758,-0.329002475780 &
            ,0.279150667398,-0.330827973590,0.045079394762,-0.024926689181,-0.605520996568,-0.954555539271,1.115322737785,0.142517216639,-1.152710422621,0.534429192130,-0.166935758520,0.883709165901 &
            ,-0.756918362344,-0.392310505158,1.456210244020,0.328665107455,-0.810385956047,0.855206821985,0.035430505696,0.310200150954,1.697914613345,-0.282442912285,-1.554459933915,-0.327581436862 &
            ,0.914178142401,-1.099503874281,0.280352438356,-1.222998290947,-1.014364125698,-3.232629457525,0.977322207842,0.485725086946,-0.988190045876,0.671954998951,0.130580258114,-0.099794807653 &
            ,1.214557887496,8.340492995198,0.805349665095,2.929642070949,2.793951356899,-0.823389878288,-1.571641545083,2.219666359289,-1.253036961688,-9.974518883839,0.497141862741,-2.268333726669 &
            ,-2.560164659730,0.866188280763,1.054980436432,-1.052916112107,0.680512677869,-3.755060237807,2.103764325458,-1.905113743268,-5.093731018454,-0.132335197187,-0.733553574151,3.903298948468 &
            ,-1.560202764318,-3.578445860372,0.047541141624,3.080295176482,-0.696229351072,-0.698460410457,0.107049918377,-3.366732394401,-2.329476835164,4.223537226848,4.118643141741,1.482765838256 &
            ,-5.274466050620,-0.660445300849,-0.341305785865,-0.650175756748,3.375055539088,9.856003069209,3.294727046779,2.854663753738,-1.457629915357,1.824264818476,-0.313315383437,0.008582573094 &
            ,14.090851231687,4.652956617283,1.489246395777,-1.478490831668,-4.162479584829,-0.447787979038,0.278073847488,-0.224430114298,11.045699759362,0.698174031160,-1.573354695427,-0.480862827366 &
            ,-0.048046259540,0.085355282259,0.105875071429,-0.218623868528,2.746444709908,0.733678503430,-9.892592680564,-2.044971986777,12.960037792047,1.405239819541,1.294045959599,-2.000322954975 &
            ,5.300367974587,-1.845019147716,-9.496213043992,-2.737738567882,15.089582179790,3.067885777783,0.097907657958,1.456836671018,6.152728754578,-3.215215487036,0.222451227919,0.401945476562 &
            ,-2.064812593337,-0.506798307156,-1.617856387024,2.340266667100,0.432297298101,-2.028299473728,0.595856396495,0.370466596861,0.530482968840,-0.092982001814,0.517520972426,0.163350524164 &
            ,0.947151155231,-1.676285305913,-1.058951891268,-1.926992470922,1.822635668860,-0.276372736208,-0.431389631274,-0.215431913380,2.084415472919,-1.108524107016,-3.053901785982,-1.255873591262 &
            ,1.741605918815,-0.712484418096,0.730499009272,-0.332073131439,-0.251516077614,-0.663034751174,-1.441704285690,-1.096145470382,1.663375683168,1.001045774548,-0.383323369863,0.567733546972 &
            ,-1.169485230978,-0.612522465570,-2.175566558499,1.375337282042,-0.584825997038,-0.341621602699,0.321824442584,-0.744843209213,1.624267432152,0.312570099712,1.678635361569,3.599034622707 &
            ,3.211107055748,-1.201975093937,-1.140387253359,-3.102104883246,-3.793478119299,1.821125065742,-2.510601310520,-3.818729619639,1.576038159240,1.239073360895,0.851667045581,1.128611862261 &
            ,-0.019200536781,2.415481524628,-1.314607607673,-1.063021832120,2.860716454826,0.199155228739,0.210921972900,0.450959211107,2.359890468403,1.735930057457,1.870144711022,2.464638451477 &
            ,-1.342847289393,-0.314357686236,-0.521335113727,-0.813813200563,5.315808254515,5.075438563405,-1.035706581068,-0.601340674455,-0.734508738786,-0.013805266032,1.114403876578,-2.683662547311 &
            ,0.009874917194,-3.590727990740,-0.039049951012,0.844170810366,0.931749988666,0.748358033377,-0.195369533139,0.137046689938,13.321726173879,-4.521922305769,-3.725145658727,-3.195021187957 &
            ,7.111634560611,-0.968398232794,0.293734598873,1.241690908149,22.174312800232,-0.735049744616,-1.613744578647,-1.877394146925,2.332231792986,0.615190125016,-1.064570105267,5.471378726771 &
            ,22.347520558757,-6.771468994460,-0.797139486904,2.485310129466,-1.312727201101,0.745816128993,-0.050394918135,-1.746503448006,32.328185336768,-2.953487550040,-12.983407381832,1.713712492725 &
            ,3.499941777677,-0.976746016185,-0.841027820365,0.534958583344,26.454715145701,1.942791283047,-4.984799076844,5.043384348079,5.439931038500,8.216006341442,-1.234038497873,1.787611592118 &
            ,15.514807372381,3.993951253322,-9.741130633162,2.411317193944,9.822466542507,14.949635726902,-1.173344006780,-1.259119315040,-7.749249807468,-0.292779333945,1.972409130699,1.078624597407 &
            ,-0.039028747043,2.746271449975,-2.009897831262,1.543709282649,5.182193952916,-2.918674476550,0.050102819297,0.815816149334,-0.427546016444,0.003849097077,0.602038957802,-2.163412702988 &
            ,0.967680588862,-3.352025482855,0.121012097808,0.770188278703,1.361066914118,1.682503250492,-1.097777814137,-0.075041061912,-0.121396114457,-0.878446146314,-0.537784703970,-0.564138025971 &
            ,-0.680700325109,0.283397407749,-0.440826817824,-1.004013542023,-2.060092949960,-0.724870785366,0.662641440150,-1.278581456431,-1.320320588557,-0.664213508587,-0.896065267525,-0.298790025340 &
            ,-3.359879865187,-0.483947536786,-0.207826001963,-2.781826816820,-1.632849391137,0.072656236192,-0.478718864265,-0.124421450013,0.259372909708,-0.076045354967,-0.022156695211,1.256782887383 &
            ,1.490811365290,-1.289181040543,-1.901281373470,-1.211068594377,-2.424522942016,-3.673827871948,0.877564270586,-2.920173393346,-4.371838690744,-0.621715932708,1.843898555647,-4.937736727229 &
            ,0.997520702546,-4.598517422714,-1.169064701360,-0.805665055374,0.822447555481,-0.073554200732,0.268106499632,-0.169482089686,-0.301286488100,2.271306858493,0.478943773785,-0.158085699990 &
            ,-0.115761029363,0.187598127245,-0.103678125190,0.604383545677,-0.128997156185,-1.237078228396,-0.976410013692,-0.215663892638,0.489385873466,-0.150827589118,0.180074302826,-0.479809965033 &
            ,-0.107532350364,-1.503633149172,-0.553507738472,0.043296156775,0.535547019185,-0.017270849442,0.049075252382,-0.212272855493,-2.103562100307,2.283853603918,-0.193884782976,0.216858701252 &
            ,0.174787049331,0.459939951584,-0.026505351747,0.161086029353,-1.276845045650,-1.911602804613,-0.372690872364,-0.195614001133,0.100127394026,-0.198979072523,-0.057161580990,0.096068532630 &
            ,-0.057425987285,0.493850119762,0.456671076263,-0.076738129281,-0.365898802774,-0.283692064309,-0.272850159188,0.854136060045,-2.749471456061,1.780659116045,0.519760095733,-0.781612139521 &
            ,-0.597638497646,0.567428372889,0.578960395563,-0.766376107585,-0.730331343257,-0.697446350320,-0.242615549667,-0.344378615197,0.478080443003,-0.431307370012,0.075204872344,0.074501861759 &
            ,0.073426774510,3.816923535240,0.940090438886,0.496242194508,-0.600707382621,-0.982498752105,-0.304805551692,0.708334330870,-0.345125045117,0.498885190528,-0.010006351625,-0.113888758300 &
            ,0.284257607302,0.202372682003,0.190116286823,-0.260075127054,-0.367278187543,-0.548574002748,0.136647010266,0.077535071151,-0.094689920123,-0.001539821475,0.016309092466,-0.093576424640 &
            ,-0.010261039605,1.802029111280,-0.069944870984,-0.028426464434,0.046763825935,-0.028542951726,0.039000288292,0.073447381495,0.382604055560,1.185749981255,-0.033879355724,-0.041244198830 &
            ,0.068286663384,-0.025816528877,0.091641285601,-0.017184510770,0.116009423043,0.584670578929,-0.215681465654,-0.165271904344,0.235109914927,0.070439198399,0.130928777106,0.015114494456 &
            ,-0.118967477295,-0.492968591565,-0.054982878483,0.158314581386,0.296345315972,0.167145641510,0.076891300729,-0.057670298329,-0.247016009246,-0.053903373200,-0.145027407692,-0.158350453340 &
            ,0.014922171975,0.027474278187,0.073557718691,0.110901195746,0.377369956183,-1.037855072233,-0.077621597234,0.109799223196,0.273114334607,0.015254956283,-0.054734129577,0.217444509271 &
            ,-0.198060077982,-0.060416351770,-0.747919315114,-0.025196010854,0.608137050689,-0.105525394227,-0.247120451362,0.764569644425,-0.466720889184,0.271380236194,-0.612108403578,0.166844704344 &
            ,0.278704854888,-0.098473810082,-0.180539937167,0.418312515353,0.060393707898,0.936573158615,0.106349467716,-0.006738177928,-0.303828941799,-0.120041685749,-0.197830282392,0.627288771647 &
            ,0.386705309264,1.903022284875,0.628516087321,0.365270723355,-0.350870267672,-0.206747063439,-0.378605329942,0.738487258538,0.082903002091,1.370478650846,0.353374497660,0.037027326603 &
            ,-0.185501557378,0.024557064677,-0.043892198480,0.159137919455,-0.442521775465,-0.883569658142,0.522908550709,0.179877900991,-0.376683585194,0.162784567182,-0.010136252993,-0.075743743414 &
            ,-0.406565019829,-0.892677849572,-0.009790304210,-0.063978069266,-0.005412704156,0.143984086072,0.143979019431,-0.322961007697,0.625876236052,-0.962863502084,0.125453052787,0.499531895311 &
            ,-0.048156259083,-0.135233895949,-0.052715949982,-0.318602206696,0.192340261604,-1.544406522742,-0.024913682546,0.613833579903,0.464234430986,0.052022724159,0.056455675221,-0.739873470561 &
            ,-0.217349433605,-0.394787160638,-0.002250573300,0.208921744626,0.448458897961,0.235900368466,0.141091767285,-0.496236298196,-0.063169790014,-0.089229280966,0.064215119219,0.034006933728 &
            ,-0.015113706581,0.039371775654,-0.002882137757,-0.002611751739,0.039643188126,-0.302029833207,-0.030345608900,0.046866290011,0.050627372994,-0.019565610198,-0.016106633603,0.006525253558 &
            ,0.030703602191,-0.108847579166,0.020085878723,0.029625817472,0.006737728241,-0.027529840504,-0.018340402413,0.007484078533,-0.063590858613,-0.108965460068,0.039041150204,0.048312400680 &
            ,-0.023076693523,-0.022508933288,-0.005303060658,-0.057673116446,-0.002077776544,-0.104923338152,0.022523698208,0.020113266865,0.011133455199,0.007451304415,-0.001182705871,-0.009980552292 &
            ,-0.016260048036,0.103521287091,0.024429973064,-0.043692536668,-0.048902563154,0.011973638137,0.019215586045,-0.015570216357,0.006152614083,-0.158547633359,-0.019109287222,0.020473208527 &
            ,0.079994003772,0.023756307121,0.010626068612,-0.030544089054,-0.009071508120,-0.378771592981,-0.068564072024,0.003561152721,0.169843686887,-0.081458779908,-0.037192333711,0.016633699210 &
            /),(/8,126/))
real, dimension(2,8) :: hidden1 = &
  Reshape((/-1.1408,4.8507 &
            ,-0.47469,0.59791,2.7951,-31.281 &
            ,2.8694,-0.77683 &
            ,7.1376,18.1565 &
            ,-5.021,-46.6275 &
            ,9.3217,-10.745 &
            ,3.0589,-14.6925 &
            /),(/2,8/))
real, dimension(1,2) :: hidden2 = &
  Reshape((/0.82423,-12.764/),(/1,2/))
real, dimension(8) :: bias1 = &
  (/-10.7466,-5.9254,3.6858,-2.2737,5.0949,-0.56974,1.4458,0.26587/)
real, dimension(2) :: bias2 = &
  (/-10.1479,17.6167/)
real, dimension(1) :: bias3 = &
  (/0.17772/)
contains
subroutine fnet_MTZ_initall()
end subroutine fnet_MTZ_initall
subroutine fnet_MTZ_engine(inarray, outarray, init)
  intrinsic MatMul, Size
  real, dimension(:), intent(in) :: inarray
  real, dimension(:), intent(inout) :: outarray
  real, dimension(126) :: inarray2
  real (kind=8), dimension(8) :: layer1
  real (kind=8), dimension(2) :: layer2
  real (kind=8), dimension(1) :: layer3
  integer , intent(inout) :: init
  integer :: i, j
  do i = 1, 126
    inarray2(i) = inarray(127-i)
  end do
  layer1 = MatMul(input,inarray2)
  layer1 = layer1 + bias1
  do i = 1, Size(layer1,1)
    layer1(i) = 1.0 / (1.0 + DEXP(-1.0 * layer1(i)))
  end do
  layer2 = MatMul(hidden1,layer1)
  layer2 = layer2 + bias2
  do i = 1, Size(layer2,1)
    layer2(i) = 1.0 / (1.0 + DEXP(-1.0 * layer2(i)))
  end do
  layer3 = MatMul(hidden2,layer2)
  layer3 = layer3 + bias3
  outarray(1) = layer3(1)
end subroutine fnet_MTZ_engine
end module fnet_MTZ
